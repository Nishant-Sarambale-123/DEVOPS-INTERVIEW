Great question üëç Interviewers often dive deep into **Argo CD Image Updater (AIU)** because it connects CI (Jenkins) with CD (ArgoCD). Let me give you a **complete step-by-step guide** on how to configure it in Kubernetes.

---

# üöÄ Argo CD Image Updater ‚Äì Full Setup Guide

## **1. What is Argo CD Image Updater?**

* A companion tool for Argo CD.
* It monitors container registries (like **AWS ECR, Docker Hub, GCR**) for new image tags.
* Updates Kubernetes manifests (in your GitOps repo) with the new tag.
* Argo CD then syncs and deploys the new version automatically.

---

## **2. Prerequisites**

* ‚úÖ A running **Kubernetes cluster**
* ‚úÖ **Argo CD** installed & configured
* ‚úÖ Jenkins (or any CI) already pushing Docker images to **ECR**
* ‚úÖ Access to your container registry (AWS ECR in our case)

---

## **3. Install Argo CD Image Updater**

Run:

```bash
kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-image-updater/master/manifests/install.yaml
```

This deploys the Image Updater pod inside the `argocd` namespace.

---

## **4. Configure Access to AWS ECR**

### Create AWS IAM user or role with permissions:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ecr:GetAuthorizationToken",
        "ecr:BatchGetImage",
        "ecr:DescribeImages"
      ],
      "Resource": "*"
    }
  ]
}
```

### Create Kubernetes Secret for ECR creds:

```bash
aws ecr get-login-password --region ap-south-1 | \
kubectl create secret docker-registry ecr-credentials \
  --docker-server=123456789012.dkr.ecr.ap-south-1.amazonaws.com \
  --docker-username=AWS \
  --docker-password-stdin \
  -n argocd
```

---

## **5. Annotate Your Argo CD Application**

Suppose you have a **Kubernetes Deployment manifest** managed by ArgoCD:

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: myapp
  namespace: argocd
  annotations:
    # Define image registry to monitor
    argocd-image-updater.argoproj.io/image-list: myapp=123456789012.dkr.ecr.ap-south-1.amazonaws.com/myapp-repo
    
    # Update strategy (latest tag, semver, digest)
    argocd-image-updater.argoproj.io/myapp.update-strategy: latest
    
    # Authentication to ECR
    argocd-image-updater.argoproj.io/myapp.pull-secret: pullsecret:argocd/ecr-credentials
spec:
  project: default
  source:
    repoURL: https://github.com/org/gitops-repo.git
    path: apps/myapp
    targetRevision: main
  destination:
    server: https://kubernetes.default.svc
    namespace: myapp-ns
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
```

---

## **6. How It Works (Flow)**

1. Jenkins builds & pushes image ‚Üí `123456789012.dkr.ecr.ap-south-1.amazonaws.com/myapp-repo:build-45`
2. Argo CD Image Updater checks ECR ‚Üí finds new tag.
3. Updates GitOps repo ‚Üí modifies `Deployment.yaml` (container image tag).
4. Argo CD detects manifest change ‚Üí syncs with cluster.
5. Kubernetes pulls the new image ‚Üí deploys updated version.

---

## **7. Common Update Strategies**

* **Latest Tag** (use the most recent tag):

  ```yaml
  argocd-image-updater.argoproj.io/myapp.update-strategy: latest
  ```

* **SemVer** (use highest semantic version like `1.2.3`):

  ```yaml
  argocd-image-updater.argoproj.io/myapp.update-strategy: semver
  ```

* **Digest (SHA256)** (update when digest changes):

  ```yaml
  argocd-image-updater.argoproj.io/myapp.update-strategy: digest
  ```

---

## **8. Debugging & Monitoring**

Check Image Updater logs:

```bash
kubectl logs -n argocd deploy/argocd-image-updater
```

If updates are not happening, confirm:

* The `Application` has the right annotations.
* ECR credentials are working.
* Image tags exist in ECR.

---

## **9. Security Best Practices**

* Use IAM roles for service accounts (IRSA) in EKS instead of static keys.
* Store ECR credentials as **Kubernetes Secret** (never hardcode).
* Use digest-based deployments for production (avoids tag overwrite issues).

---

‚úÖ That‚Äôs the **full setup of Argo CD Image Updater in Kubernetes**.
It connects your Jenkins CI ‚Üí AWS ECR ‚Üí GitOps ‚Üí ArgoCD ‚Üí Kubernetes automatically.

---

Would you like me to also prepare a **real Argo CD Application manifest + Deployment YAML** (before and after update) so you can **show exact example in interview**?
